<title>accesodenegado - base de datos Exploits </title>
<link href="../scripts/acceso.css" rel="stylesheet" type="text/css">
<body bgcolor="#999999" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<? include "inc/cabecera.ad" ?>
  <tr> 
    <td width="30%" bgcolor="#999999">&nbsp;</td>
    <td width="70%" bgcolor="#999999" class="textBold">Actualizaci&oacute;n de 
      exploits </td>
    <td bgcolor="#999999"><img src="ima/logoweb2.gif" width="119" height="43"></td>
  </tr>
  <tr> 
    <td bgcolor="#999999">&nbsp;</td>
    <td align="center" valign="middle" bgcolor="#999999" class="text"><br>
      <br>
      <br>
      <br>
      <br>

<?
include ("inc/funciones.php");
$LastModified=fecha_castellano();
if (isset($update)) unlink ("$url_exploit_bbdd"); //si estemos modificando, borramos el exploit antiguo
else $hash=rand(1,999); //para que no se repita el nombre del fichero

if ($userfile_name) {
	$nom_exploit=trim(strtolower("$userfile_name"));
	$url_exploit_en_si=$hash.$nom_exploit;
		} else
	 die ("Debes subir un exploit<br><a class=linksblancs href=\"javascript:history.go(-1)\">volver</a>");


if (!$target) die ("<center>El campo \"objetivo\" es obligatorio<br><a class=linksblancs href=\"javascript:history.go(-1)\">volver</a>");

if (strcmp($lenguaje,"cualquiera")==0)  die ("<center>El campo \"lenguaje\" debe tener un valor distinto de \"cualquiera\"<br><a class=linksblancs href=\"javascript:history.go(-1)\">volver</a>");

if ($remoto==0) $remot="sí"; else $remot="no";

$target=trim(strtolower($target));
$targetoriginal=$target;
$target=preg_replace("/[\s]+/","_",$target); //substituim els espais per "_" xq quedi un nom de fitxer consistent.

$targetversion=trim(strtolower($targetversion));
$targetversionoriginal=$targetversion;
$targetversion=preg_replace("/[\s]+/","_",$targetversion);

$nom="$target-$targetversion";

$url_exploit_bbdd="bbdd/$SO/$nom-$url_exploit_en_si";

$lineasComentario=trim(`/bin/echo -e "$comentario"|/usr/bin/wc -l`);

$fichero="
<i>$url_exploit_en_si</i>
tipo: $tipo
objetivo: $targetoriginal
version: $targetversionoriginal
SO: $SO $versionSO
arquitectura: $arquitectura
lenguaje: $lenguaje
remoto: $remot
comentario: $comentario
Última modificación: $LastModified
";

`/bin/echo -e "$fichero" > $url_exploit_bbdd`;
`/bin/echo -e "<a class=linksblancs target= \"_blank\" href=\"exploits/$url_exploit_en_si\">descargar </a>" >> $url_exploit_bbdd`;
`/bin/echo -e "<a class=linksblancs href=\"update.php?url_exploit_bbdd=$url_exploit_bbdd&url_exploit_en_si=$url_exploit_en_si&lineasComentario=$lineasComentario\">modificar </a>" >> $url_exploit_bbdd`;
`/bin/echo -e "<a class=linksblancs href=\"delete.php?url_exploit_bbdd=$url_exploit_bbdd&url_exploit_en_si=$url_exploit_en_si\" onClick=\"return confirmar()\">borrar </a>" >> $url_exploit_bbdd`;

if ($userfile) `/bin/mv $userfile exploits/$url_exploit_en_si`;

echo "
	<div align=center>
	<span class=text>  
	el exploit ha sido añadido<br>
	<a class=linksblancs href=\"insert.php\">añadir otro exploit</a>
	<a class=linksblancs href=\"buscar.php\">buscar exploits</a></span></div>
";

?>
    </td>
    <td bgcolor="#999999">&nbsp;</td>
  </tr>
  <tr> 
    <td bgcolor="#999999">&nbsp;</td>
    <td bgcolor="#999999" class="text">&nbsp;</td>
    <td bgcolor="#999999">&nbsp;</td>
  </tr>
</table>
